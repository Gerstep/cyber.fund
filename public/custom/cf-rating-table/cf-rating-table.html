<link rel="import"
			href="/components/polymer/polymer.html">
<link rel="import"
			href="/components/core-selector/core-selector.html">
<link rel="import"
			href="/components/core-list/core-list.html">
<link rel="import"
			href="/components/core-image/core-image.html">
<link rel="import"
			href="/components/paper-item/paper-item.html">
<link rel="import"
			href="/components/cf-star-rating/cf-star-rating.html">
<link rel="import"
			href="/components/paper-button/paper-button.html">
<link rel="import"
			href="/components/cf-meteor-components/meteor-subscribe.html">
<link rel="import"
			href="/components/cf-meteor-components/meteor-query.html">
<link rel="import"
			href="/custom/cf-readable-supply/cf-readable-supply.html">
<link rel="import"
			href="/custom/cf-readable-trade-volume/cf-readable-trade-volume.html">
<link rel="import"
			href="/custom/cf-colorful-percents/cf-colorful-percents.html">
<link rel="import"
			href="/custom/cf-cap-usd/cf-cap-usd.html">
<link rel="import"
			href="/custom/cf-cap-btc/cf-cap-btc.html">
<link rel="import"
      href="/custom/cf-btc-price/cf-btc-price.html">


<polymer-element name="cf-rating-table" vertical layout style="width:90%; margin:auto; margin-top:5px;">
	<template>
		<meteor-subscribe name="current-data"></meteor-subscribe>
		<meteor-query
			collection="{{collection}}"
			query="{{query}}"
			options="{{options}}"
			data="{{current}}"
		></meteor-query>
        <div>
            <div style="text-align: right">
                <cf-btc-price currency="usd">
                </cf-btc-price>
            </div>
        </div>
		<div horizontal layout style="padding: 0.9em 1em">
			<b style="width: 50px;"><!-- System logo --></b>
			<b flex>System</b>
			<b flex style="text-align: center;">↓ Rating</b>
			<b flex style="text-align: center;">Token</b>
			<b flex style="text-align: center;">Trade</b>
			<b flex style="text-align: right;">Cap in Ƀ</b>
			<b flex style="text-align: right;">7d Change</b>
			<b flex style="text-align: right;">Cap in $</b>
			<b flex style="text-align: right;">7d Change</b>
		</div>
		<core-list data="{{current}}" id="list" flex>
			<template>
				<paper-item id="{{model._id}}">
					<div flex horizontal center layout>
						<span style="width: 50px;">
							<core-image
								style="width: 30px; height: 30px"
								sizing="contain"
								preload
								src="http://cyber.fund/logos/{{(model.name ? model.name : '') | lowercase}}.png"
							></core-image>
						</span>
						<span flex style="font-size: 1.2em;">{{model.name}}</span>
						<cf-star-rating
							value="{{model.rating}}"
							flex
							style="font-size: 1.2em; text-align: center;"
						></cf-star-rating>
						<cf-readable-supply
							percents="{{model.supplyChangePercents.week}}"
							change="{{model.supplyChange.week}}"
							absolute="{{model.supply}}"
							flex
							style="text-align: center;"
						></cf-readable-supply>
						<cf-readable-trade-volume
							deviation="{{model.tradeVolumeMedianDeviation.week}}"
							absolute="{{model.tradeVolume}}"
							flex
							style="text-align: center;"
						></cf-readable-trade-volume>
						<cf-cap-btc
							capBtc="{{model.cap.btc}}"
							priceBtc="{{model.price.btc}}"
							tokenName="{{model.name}}"
							flex
							style="text-align: right;"
						></cf-cap-btc>
						<cf-colorful-percents
							percents="{{model.capChangePercents.week.btc}}"
							change="{{model.capChange.week.btc}}"
							flex
							style="text-align: right;"
						></cf-colorful-percents>
						<cf-cap-usd
							capUsd="{{model.cap.usd}}"
							priceUsd="{{model.price.usd}}"
							tokenName="{{model.name}}"
							flex
							style="text-align: right;"
						></cf-cap-usd>
						<cf-colorful-percents
							percents="{{model.capChangePercents.week.usd}}"
							change="{{model.capChange.week.usd}}"
							flex
							style="font-size: 1.2em; text-align: right;"
						></cf-colorful-percents>
					</div>
				</paper-item>
			</template>
		</core-list>
	</template>

	<script>
		if (!window.CurrentData) {
			CurrentData = new Mongo.Collection("CurrentData");
		}

		Polymer('cf-rating-table', {
			collection: CurrentData,
			query: {
				"cap.btc": { $gt: 0 },
			},
			options: {
				sort: {
					rating: -1,
					"cap.btc": -1,
				}
			}
		});
	</script>
</polymer-element>
